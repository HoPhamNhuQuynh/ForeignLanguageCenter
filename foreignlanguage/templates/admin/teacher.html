{% extends 'admin/master.html' %}

{% block body %}
<div class="container py-5">
    <div class="row g-4">
        <div class="col-lg-5 col-xl-4">
            <div class="p-4">
                <h3 class="fw-bold mb-1">Chào giáo viên {{ current_user.name }}!</h3>
            </div>
            <div class="card border-0 shadow-sm rounded-4 mb-4 p-4">
                <h4>Chức năng</h4>
                <div class="list-group list-group-flush p-2">
                    <a href="#" class="menu-tab btn btn-orange px-5 py-3 rounded-0 fw-bold btn-lg active"
                       data-target="formDiemDanh" onclick="showForm('formDiemDanh',this)">
                        <i class="far fa-calendar-alt me-2"></i> Điểm danh
                    </a>

                    <a href="#" class="menu-tab btn btn-orange px-5 py-3 rounded-0 fw-bold btn-lg"
                       data-target="formNhapDiem" onclick="showForm('formNhapDiem',this)">
                        <i class="fas fa-edit me-2"></i> Nhập điểm
                    </a>
                </div>
            </div>
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <div class="card-body p-4">
                    <h4>Thông tin cá nhân</h4>
                    <div class="text-center mb-4">
                        <div class="position-relative d-inline-block">
                            <img src="{{ current_user.avatar or 'https://i.pravatar.cc/150?img=12' }}"
                                 class="rounded-circle border border-3 border-white shadow-sm"
                                 style="width: 110px; height: 110px; object-fit: cover;">
                            <label class="btn btn-sm btn-primary rounded-circle position-absolute bottom-0 end-0 border border-2 border-white"
                                   style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                                <i class="fas fa-camera text-white" style="font-size: 0.8rem;"></i>
                                <input type="file" class="d-none" name="avatar">
                            </label>
                        </div>
                        <h5 class="fw-bold mt-3 mb-1">{{ current_user.name }}</h5>
                        <p class="text-muted small">{{ current_user.role.name }}</p>
                    </div>

                    <form action="/update-profile" method="POST">
                        <div class="mb-3">
                            <label class="form-label small fw-bold text-secondary">HỌ VÀ TÊN</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0"><i
                                        class="far fa-user text-muted"></i></span>
                                <input type="email" class="form-control bg-light border-start-0 ps-0 text-muted"
                                       value="{{ current_user.name }}" readonly disabled>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label small fw-bold text-secondary">EMAIL</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0"><i
                                        class="far fa-envelope text-muted"></i></span>
                                <input type="email" class="form-control bg-light border-start-0 ps-0 text-muted"
                                       value="{{ current_user.email }}" readonly disabled>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label small fw-bold text-secondary">ĐỊA CHỈ</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0"><i
                                        class="fas fa-location-arrow text-muted"></i></span>
                                <input type="text" class="form-control bg-light border-start-0 ps-0" name="name"
                                       value="{{ current_user.address }}">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label small fw-bold text-secondary">SỐ ĐIỆN THOẠI</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0"><i
                                        class="fas fa-mobile-alt text-muted"></i></span>
                                <input type="tel" class="form-control bg-light border-start-0 ps-0" name="phone"
                                       value="{{ current_user.phone }}">
                            </div>
                        </div>

                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-primary fw-bold py-2 rounded-3 shadow-sm">
                                <i class="fas fa-save me-2"></i> Lưu thay đổi
                            </button>
                        </div>
                        <a href="/logout"
                           class="list-group-item list-group-item-action border-0 rounded-3 p-3 d-flex align-items-center text-danger hover-bg-danger-light">
                            <div class="text-danger rounded-3 me-3">
                                <i class="fas fa-sign-out-alt"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0 fw-bold">Đăng xuất</h6>
                            </div>
                        </a>
                    </form>
                </div>
            </div>
        </div>


        <div class="col-lg-7 col-xl-8">
            <div id="formDiemDanh" class="form-section" style="block">
                <h4 class="fw-bold">Điểm danh</h4>

                <div class="border p-3 rounded bg-orange-light">
                    <label class="fw-bold">Chọn khóa</label>
                    <select class="form-select mb-3">
                        <option value="">-- Vui lòng chọn --</option>
                        {% for c in course %}
                        <option value="{{ c.id }}">
                            {{ c.name }}
                        </option>
                        {% endfor %}
                    </select>

                    <table class="table table-bordered text-center">
                        <thead class="bg-orange">
                        <tr>
                            <th>STT</th>
                            <th>Tên học viên</th>
                            <th>
                                <select class="form-select" name="session_id">
                                    <option value="">-- Chọn buổi học --</option>
                                    {% for s in sessions %}
                                    <option value="{{ s.id }}">Buổi {{ loop.index }} - {{ s.session_content }}</option>
                                    {% endfor %}
                                </select>
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for reg in student %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ reg.student.account.name }}</td>
                            <td>
                                <input type="radio" name="{{ reg.student_id }}" value="1"> Có mặt
                                <input type="radio" name="{{ reg.student_id }}" value="0" class="ms-3"> Vắng
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>

                    <div class="text-end">
                        <button class="btn btn-orange px-4 rounded-3">Lưu điểm danh</button>
                    </div>
                </div>
            </div>
            <div id="formNhapDiem" class="form-section" style="display:none;">
                <h4 class="fw-bold">Nhập điểm</h4>

                <div class="border p-3 rounded bg-orange-light">
                    <label class="fw-bold">Chọn khóa</label>
                    <select class="form-select mb-3">
                        {% for c in course %}
                        <option value="{{ c.id }}">{{ c.name }}</option>
                        {% endfor %}
                    </select>

                    <table class="table table-bordered text-center">
                        <thead class="bg-orange">
                        <tr>
                            <th>STT</th>
                            <th>Tên học viên</th>
                            <th>Điểm chuyên cần</th>
                            <th>Điểm giữa kì</th>
                            <th>Điểm cuối kì</th>
                            <th>Điểm trung bình</th>
                            <th>Kết quả</th>
                            <th>Học lực</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for reg in student %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ reg.student.account.name }}</td>

                            <td><input type="number" class="form-control" name="cc_{{ reg.id }}" value="{{ diem_cc }}">
                            </td>
                            <td><input type="number" class="form-control" name="gk_{{ reg.id }}" value="{{ diem_gk }}">
                            </td>
                            <td><input type="number" class="form-control" name="ck_{{ reg.id }}" value="{{ diem_ck }}">
                            </td>

                            {% set dtb = (diem_cc + diem_gk + diem_ck) / 3 %}

                            <td>{{ diem_cc }}</td>
                            <td>{{ diem_gk }}</td>
                            <td>{{ diem_ck }}</td>
                            <td>{{ "%.2f"|format(dtb) }}</td>

                            <td>{{ "Đậu" if dtb >= 5 else "Rớt" }}</td>
                            <td>
                                {% if dtb >= 8 %} Giỏi
                                {% elif dtb >= 6.5 %} Khá
                                {% elif dtb >= 5 %} Trung bình
                                {% else %} Yếu
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}

                        </tbody>
                    </table>

                    <button type="submit" formaction="/save-scores"
                            class="btn btn-orange px-4 rounded-3">
                        Xuất Excel
                    </button>

                </div>
            </div>
        </div>

    </div>
</div>
</div>
<script src="{{ url_for('static', filename='js/teacher.js') }}" defer></script>
{% endblock %}