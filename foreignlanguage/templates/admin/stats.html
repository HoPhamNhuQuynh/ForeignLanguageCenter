{% extends 'admin/master.html' %}

{% block head %}
{{ super() }}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
{% endblock %}

{% block body %}
<style>
    body {
        background-color: #ffffff;
        font-family: 'Segoe UI', sans-serif;
    }

    .card {
        border: none !important;
        box-shadow: none !important;
        background-color: transparent;
        margin-bottom: 2rem;
    }

    .stat-item {
        padding: 15px 10px;
        border-bottom: 1px solid #f0f0f0;
        transition: all 0.3s;
    }
    .stat-item:hover {
        background-color: #eaeaea;
    }

    .stat-label {
        font-size: 1rem;
        color: #8898aa;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 700;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: #32325d;
        line-height: 1.5;
    }

    canvas { padding: 5px; }
</style>

<div class="container-fluid px-3 py-3">

    <h2 class="text-center mb-5" style="color: #32325d; font-weight: 800;">BÁO CÁO THỐNG KÊ TRUNG TÂM</h2>

    <div class="row mb-3">
        <div class="col-xl-3 col-md-6">
            <div class="stat-item d-flex justify-content-between align-items-center">
                <div>
                    <div class="stat-label">Total Courses</div>
                    <div class="stat-value">12</div>
                </div>
                <div class="icon-shape bg-gradient-red text-white rounded-circle shadow">
                    <i class="fas fa-book fa-2x text-primary" style="opacity: 0.3"></i>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="stat-item d-flex justify-content-between align-items-center">
                <div>
                    <div class="stat-label">Active Classes</div>
                    <div class="stat-value text-success">8</div>
                </div>
                <i class="fas fa-chalkboard-teacher fa-2x text-success" style="opacity: 0.3"></i>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="stat-item d-flex justify-content-between align-items-center">
                <div>
                    <div class="stat-label">Total Students</div>
                    <div class="stat-value text-info">150</div>
                </div>
                <i class="fas fa-users fa-2x text-info" style="opacity: 0.3"></i>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="stat-item d-flex justify-content-between align-items-center">
                <div>
                    <div class="stat-label">Total Revenue</div>
                    <div class="stat-value text-warning">$25,000</div>
                </div>
                <i class="fas fa-dollar-sign fa-2x text-warning" style="opacity: 0.3"></i>
            </div>
        </div>
    </div>

    <div class="d-flex justify-content-end align-items-center mb-3">

        <label for="yearSelector" class="text-muted fw-bold me-2 mb-0" style="font-size: 1rem;">
            Thống kê năm:
        </label>

        <select class="form-select form-select-sm w-auto bg-light border-0 shadow-none fw-bold text-secondary cursor-pointer" id="yearSelector">
            <option value="2024">2024</option>
            <option value="2025" selected>2025</option>
            <option value="2026">2026</option>
        </select>

    </div>
    <div class="row mb-3">
        <div class="col-md-3">
            <div class="card h-100">
                <div class="card-body p-0">
                    <canvas id="chartPassRate"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-body p-0">
                    <canvas id="chartRevenue"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card h-100">
                <div class="card-body p-0">
                    <canvas id="chartStudentDist"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-body p-0">
                    <canvas id="chartTopCourses"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-body p-0">
                    <canvas id="chartTopTeachers"></canvas>
                </div>
            </div>
        </div>

    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card h-100">
                <div class="card-body p-0">
                    <canvas id="chartCapacity"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-body p-0">
                    <canvas id="chartLevelRadar"></canvas>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}

{% block tail %}
{{ super() }}
<script>


    Chart.defaults.font.family = "'Segoe UI', sans-serif";
    Chart.defaults.color = '#8898aa';

    function getChartTitle(text) {
        return {
            display: true,
            text: text,
            align: 'start',
            color: '#334455',
            font: { size: 16, weight: 'bold' },
            padding: { bottom: 20 }
        };
    }

    new Chart(document.getElementById("chartPassRate"), {
        type: 'pie',
        data: {
            labels: ['Đạt (Pass)', 'Trượt (Fail)'],
            datasets: [{
                data: [75, 25],
                backgroundColor: ['#2dce89', '#f5365c'],
                borderWidth: 0
            }]
        },
        options: {
            plugins: {
                title: getChartTitle('TỶ LỆ HỌC VIÊN ĐẠT'),
                legend: { position: 'right' }
            }
        }
    });

    let line_labels = {{ date_labels | tojson | default('[]') }};
    let revenue = {{ over_time_revenue | tojson | default('[]') }};
    new Chart(document.getElementById("chartRevenue"), {
        type: 'line',
        data: {
            labels: line_labels ,
            datasets: [{
                label: 'Doanh thu (VND)',
                data: revenue,
                borderColor: '#5e72e4',
                backgroundColor: 'rgba(94, 114, 228, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            scales: { y: { grid: { borderDash: [2, 2] } } },
            plugins: {
                title: getChartTitle('DOANH THU THEO THÁNG'),
                legend: { display: false }
            }
        }
    });


    new Chart(document.getElementById("chartTopCourses"), {
        type: 'bar',
        data: {
            labels: ['IELTS Basic', 'TOEIC 500', 'Giao tiếp', 'IELTS Adv', 'Kid English'],
            datasets: [{
                label: 'Số đăng ký',
                data: [120, 90, 80, 70, 50],
                backgroundColor: '#11cdef',
                borderRadius: 5
            }]
        },
        options: {
            plugins: {
                title: getChartTitle('TOP 5 KHÓA HỌC HOT'),
                legend: { display: false }
            },
            scales: { x: { grid: { display: false } } }
        }
    });

    let doughnut_labels = {{ course_label | tojson | default('[]') }};
    let number_of_students = {{ numbers_of_students | tojson | default('[]') }};
    new Chart(document.getElementById("chartStudentDist"), {
        type: 'doughnut',
        data: {
            labels: doughnut_labels,
            datasets: [{
                data: number_of_students,
                backgroundColor: ['#5e72e4', '#2dce89', '#11cdef', '#f3a4b5'],
                borderWidth: 0
            }]
        },
        options: {
            cutout: '50%',
            plugins: {
                title: getChartTitle('PHÂN BỔ HỌC VIÊN'),
                legend: { position: 'bottom' }
            }
        }
    });


    new Chart(document.getElementById("chartCapacity"), {
        type: 'bar',
        data: {
            labels: ['Lớp 101', 'Lớp 102', 'Lớp 103'],
            datasets: [
                {
                    label: 'Hiện tại',
                    data: [18, 25, 10],
                    backgroundColor: '#5e72e4',
                    borderRadius: 4
                },
                {
                    label: 'Tối đa',
                    data: [20, 30, 20],
                    backgroundColor: '#e9ecef',
                    borderRadius: 4
                }
            ]
        },
        options: {
            plugins: {
                title: getChartTitle('SĨ SỐ THỰC TẾ vs TỐI ĐA'),
            },
            scales: { x: { grid: { display: false } } }
        }
    });

    new Chart(document.getElementById("chartTopTeachers"), {
        type: 'bar',
        data: {
            labels: ['Cô Lan', 'Thầy Hùng', 'Cô Mai'],
            datasets: [{
                label: 'Rating',
                data: [4.9, 4.8, 4.7],
                backgroundColor: '#fb6340',
                barThickness: 20,
                borderRadius: 10
            }]
        },
        options: {
            indexAxis: 'y',
            plugins: {
                title: getChartTitle('TOP 3 GIÁO VIÊN'),
                legend: { display: false }
            },
            scales: { x: { display: false }, y: { grid: { display: false } } }
        }
    });

    // --- 7. RADAR: LEVEL BANDS ---
    new Chart(document.getElementById("chartLevelRadar"), {
        type: 'radar',
        data: {
            labels: ['Band 4.0', 'Band 5.0', 'Band 6.0', 'Band 7.0', 'Band 8.0'],
            datasets: [{
                label: 'Phân bổ',
                data: [10, 30, 40, 15, 5],
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderColor: 'rgba(255, 99, 132, 1)',
                pointBackgroundColor: 'rgba(255, 99, 132, 1)',
            }]
        },
        options: {
            plugins: {
                title: getChartTitle('LEVEL DISTRIBUTION'),
                legend: { display: false }
            },
            scales: {
                r: {
                    ticks: { display: false },
                    grid: { color: '#e9ecef' }
                }
            }
        }
    });

</script>
{% endblock %}